# .github/workflows/speedtest.yml
name: Clash Speed Test and Sort

on:
  workflow_dispatch: # 允许手动触发
  schedule:
    - cron: '0 */6 * * *' # 每6小时运行一次，您可以根据需要调整

jobs:
  speed-test-and-sort:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Make Speedtest Tool Executable
      run: chmod +x ./speedtest-clash

    - name: Run Speed Test and Sort
      # 执行速度测试并排序，然后保存到 clash.yaml
      # 根据 v0.2.4 版本的用法调整参数
      run: |
        ./speedtest-clash \
          -c ./clash_config.yaml \
          -output ./clash.yaml \
          -sort b \
          -size 52428800 \
          -timeout 10s
        # 注意：v0.2.4 版本可能不直接支持同时按下载速度和延迟排序。
        # `-sort b` 是按带宽（下载速度）排序。
        # 如果需要严格按延迟排序，可能需要单独运行一次，或者检查是否有其他隐式排序行为。
        # 50MB 转换为字节是 50 * 1024 * 1024 = 52428800 字节。
